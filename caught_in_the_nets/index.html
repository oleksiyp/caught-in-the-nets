<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Caught in the nets</title>
  <link rel="stylesheet" href="themes/citn.min.css" />
  <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />

  <link rel="stylesheet" href="3party/jquery.mobile.structure-1.4.5.min.css" />
  <script src="3party/jquery.min.js" type="text/javascript"></script>
  <script src="3party/jquery.mobile-1.4.5.min.js"></script>
  <style type="text/css">
.header p {
  font-size: 20px;
  font-size: 2.0vw;
  font-family: monospace;
  white-space: pre-wrap;
}
.wide .header p {
  font-size: 24px !important;
  max-width: 1200px;
  margin: 0 auto;
}

.text p {
  font-size: 20px;
  font-size: 2.1vw; 
  font-family: monospace;
  white-space: pre-wrap;
}
.wide .text p {
  font-size: 24px !important;
  max-width: 1200px;
  margin: 0 auto;
}
.text.half p {
  font-size: 3.2vw;
}
.wide .text.half p {
  max-width: 500px !important;
}
.half img {
  max-width: 93% !important;
}
img {
  border:5px solid #fff;
  box-shadow: 0 2px 0 #444;
  max-width: 70%
}
  </style>

<script type="text/javascript">
var lastN = 10;
var screen = "large";
var issueN = 0;
var half = "";

function cut(s, l, e) {
  if (s.length > l) {
    return s.substring(0, l) + e;
  } else {
    return s;
  }
}

function fmtIndex(n) {
  if (n < 10) {
     return "00" + n;
  } else if (n < 100) {
     return "0" + n;
  } else {
     return "" + n;
  }
}


function hasHalf(n) {
     return n >= 10;
}

function linkify(inputText) {
    //URLs starting with http://, https://, or ftp://
    var replacePattern1 = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
    return inputText.replace(replacePattern1, function (s) { return '<a class="outlink" href="' + s + '">' + cut(s, 36, "...") + '</a>'; });
}


function imgify(n, inputText) {
    //URLs starting with http://, https://, or ftp://
    var replacePattern1 = /\bIMG:([-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
    return inputText.replace(replacePattern1, '<img src="' + fmtIndex(n) + '$1" target="_blank">');
}

function setLocation() {
    checkHalf();
    window.location.hash = "#" + issueN + half;
}

function setHalf(newVal) {
  if (newVal) {
     if (!half) {
       half = "half";
       $(".text").toggleClass("half", true);
       setLocation();
     }
  } else {
    if (half) {
      half = "";
      $(".text").toggleClass("half", false);
      setLocation();
    }
  }
}

function checkHalf() {
  if (!hasHalf(issueN)) {
     setHalf();
  }
}

function jumpIssues() {
  window.location.hash = "#issues";
}

function parseLocation() {
  issueN = window.location.hash.substring(1);
  if (/^\d+(half)?$/.test(issueN)) {
    setHalf(/half$/.test(issueN));
    issueN = parseInt(issueN);
    checkHalf();
    return true;
  }
  jumpIssues();
  return false;
}

function previousIssue() {
    if (parseLocation()) {
      issueN = issueN - 1;
      if (issueN == 0) {
        jumpIssues();
        return;
      } 
    } else {
      issueN = lastN;
    }
    setLocation();
}


function nextIssue() {
    if (parseLocation()) {
      issueN = issueN + 1;
      if (issueN > lastN) {
        jumpIssues();
        return;
      } 
    } else {
      issueN = 1;
    }
    setLocation();
}

function loadIssue() {
  if (parseLocation()) {
    $.ajax({
      url : fmtIndex(issueN) + half + ".txt",
      dataType: "text",
      success : function (issueText) {
        var textPar = $(".text p")
        textPar.text(issueText);

        var issueHtml = textPar.html();
        issueHtml = linkify(issueHtml);
        issueHtml = imgify(issueN, issueHtml);
        textPar.html(issueHtml);
       }
    });
  } else {
    $(".text p").html("");
  } 
}

function switchScreenType(screenType) {
  switch(screenType) {
  case 'normal':
    $(".page").toggleClass("wide", false);
    setHalf(false);
    break;    
  case 'wide':
    $(".page").toggleClass("wide", true);
    setHalf(false);
    break;    
  case 'half':
    $(".page").toggleClass("wide", false);
    setHalf(true);
    break;
  }
}

function responsiveness() {
  var width = $(window).width();
  if (width < 500) {
    switchScreenType("half");
  } else if (width >= 1200) {
    switchScreenType("wide");
  } else {
    switchScreenType("normal");
  }
}

$(function(){
    parseLocation();
    $("body" ).on( "swipeleft", nextIssue );
    $("body" ).on( "swiperight", previousIssue );
    $(window).bind('resize', responsiveness);
    responsiveness();
    $('.issues a').bind('click', function(ev) {
      window.location.hash = $(this).attr('href');
      return false;
    });
    $("body").keydown(function(e) {
      if(e.keyCode == 37) { previousIssue(); }
      else if(e.keyCode == 39) { nextIssue(); }
    });
    loadIssue();
    $(window).bind('hashchange', loadIssue );
});
</script> 
</head>
<body>
<div data-role="page" data-theme="a" class="page">
<div data-role="header" data-position="inline" class="header">
<p>
   _____               __   __    _        __  __                  __
  / ___/__ ___ _____ _/ /  / /_  (_)__    / /_/ /  ___   ___  ___ / /____
 / /__/ _ `/ // / _ `/ _ \/ __/ / / _ \  / __/ _ \/ -_) / _ \/ -_) __(_-<
 \___/\_,_/\_,_/\_, /_//_/\__/ /_/_//_/  \__/_//_/\__/ /_//_/\__/\__/___/
               /___/
</p>
</div>
<div data-role="content" data-theme="a">
<div class="text"><p></p></div>
<ul class="issues" data-role="listview">
  <li><a href="#1">issue #1 of 19-Sep '15</a></li>
  <li><a href="#2">issue #2 of 26-Sep '15</a></li>
  <li><a href="#3">issue #3 of 3-Oct '15</a></li>
  <li><a href="#4">issue #4 of 9-Oct '15</a></li>
  <li><a href="#5">issue #5 of 12-Oct '15</a></li>
  <li><a href="#6">issue #6 of 16-Oct '15</a></li>
  <li><a href="#7">issue #7 of 19-Oct '15</a></li>
  <li><a href="#8">issue #8 of 23-Oct '15</a></li>
  <li><a href="#9">issue #9 of 29-Oct '15</a></li>
  <li><a href="#10">issue #10 of 29-Oct '15</a></li>
</ul>
</p></div>
</div></body></html>
