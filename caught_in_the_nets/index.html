<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Caught in the nets</title>
  <link rel="stylesheet" href="themes/citn.min.css" />
  <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>
  <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
  <style type="text/css">
.mono p {
  font-size: 20px; 
  font-size: 2.15vw; 
  font-family: monospace;
  white-space: pre-wrap;
}
  </style>
<script type="text/javascript">
var lastN = 9;

function cut(s, l, e) {
  if (s.length > l) {
    return s.substring(0, l) + e;
  } else {
    return s;
  }
}

function linkify(inputText) {
    //URLs starting with http://, https://, or ftp://
    var replacePattern1 = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
    return inputText.replace(replacePattern1, function (s) { return '<a class="outlink" href="' + s + '">' + cut(s, 70, "...") + '</a>'; });
}


function imgify(inputText) {
    //URLs starting with http://, https://, or ftp://
    var replacePattern1 = /(\bIMG:[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
    return inputText.replace(replacePattern1, '<img src="$1" target="_blank">$1</a>');
}

function previousIssue() {
  var issueN = window.location.hash.substring(1);
  if (/^\d+$/.test(issueN)) {
    issueN = parseInt(issueN) - 1;
    if (issueN == 0) {
      window.location.hash = "";
      return;
    } 
  } else {
    issueN = lastN;
  }
  window.location.hash = "#" + issueN;
}

function nextIssue() {
  var issueN = window.location.hash.substring(1);
  if (/^\d+$/.test(issueN)) {
    issueN = parseInt(issueN) + 1;
    if (issueN > lastN) {
      window.location.hash = "";
      return;
    } 
  } else {
    issueN = 1;
  }
  window.location.hash = "#" + issueN;
}

function loadIssue() {
  var issueN = window.location.hash.substring(1);
  if (/^\d+$/.test(issueN)) {
    $.ajax({
      url : issueN + ".txt",
      dataType: "text",
      success : function (data) {
        $(".text").text(data);
        $(".text").html(imgify(linkify($(".text").html())));
       }
    });
  } else {
    $(".text").html("");
  } 
}

$(function(){
    $(".text").html(imgify(linkify($(".text").html())));
    $("body" ).on( "swipeleft", nextIssue );
    $("body" ).on( "swiperight", previousIssue );
    $("body").keydown(function(e) {
      if(e.keyCode == 37) { previousIssue(); }
      else if(e.keyCode == 39) { nextIssue(); }
    });
    loadIssue();
    $(window).bind('hashchange', loadIssue );
});
</script> 
</head>
<body>
<div data-role="page" data-theme="a">
<div data-role="header" data-position="inline" class="mono">
<p><a name="4">
   _____               __   __    _        __  __                  __
  / ___/__ ___ _____ _/ /  / /_  (_)__    / /_/ /  ___   ___  ___ / /____
 / /__/ _ `/ // / _ `/ _ \/ __/ / / _ \  / __/ _ \/ -_) / _ \/ -_) __(_-<
 \___/\_,_/\_,_/\_, /_//_/\__/ /_/_//_/  \__/_//_/\__/ /_//_/\__/\__/___/
               /___/
</a></p>
</div>
<div data-role="content" data-theme="a" class="mono"><p class="text">http://google.com</p><p><ul data-role="listview">
  <li><a href="#1">issue #1 of 19-Sep '15</a></li>
  <li><a href="#2">issue #2 of 26-Sep '15</a></li>
  <li><a href="#3">issue #3 of 3-Oct '15</a></li>
  <li><a href="#4">issue #4 of 9-Oct '15</a></li>
  <li><a href="#5">issue #5 of 12-Oct '15</a></li>
  <li><a href="#6">issue #6 of 16-Oct '15</a></li>
  <li><a href="#7">issue #7 of 19-Oct '15</a></li>
  <li><a href="#8">issue #8 of 23-Oct '15</a></li>
  <li><a href="#9">issue #9 of 29-Oct '15</a></li>
</ul>
</p></div>
</div></body></html>
